# How to upgrade from TDW v1.7 to TDW v1.8

## Read the changelog

[Read this](Changelog.md) for a complete list of changes.

## Graphics improvement

There was a persistent bug in TDW that caused certain models and materials to not cast shadows or reflect light correctly. This has been fixed.

 ## Removed commands

Removed `toggle_image_sensor`. You should use `enable_image_sensor` instead.

## Asset Bundle Creator

If you've used the [Asset Bundle Creator](misc_frontend/add_local_object.md) in TDW v1.7 or prior, delete the directory. The next time you use the Asset Bundle Creator, it will recreate the directory and Unity project.

## Deprecated the Sticky Mitten Avatar and added the Magnebot

**The Sticky Mitten Avatar has been deprecated,** meaning that we don't plan to continuously improve the Sticky Mitten Avatar unless a specific ongoing project needs support.

The Sticky Mitten Avatar has been replaced with the [Magnebot](misc_frontend/robots.md) which has a new [high-level API](https://github.com/alters-mit/magnebot). The Magnebot retains most of the same functionality as the Sticky Mitten Avatar but *far* less buggy. We strongly recommend any new projects that want to use TDW for quasi-robotics experiments to use the Magnebot, and we encourage anyone still using the Sticky Mitten Avatar to upgrade to the Magnebot if possible. 

### Key Differences

- The Magnebot uses Unity's new ArticulationBody component instead of the old HingeJoint component used by the Sticky Mitten Avatar. HingeJoints tend to stretch or glitch; ArticulationBodies don't have these problems.
- The Magnebot is a robot, not an avatar. It won't respond to avatar commands such as `turn_avatar_by` and it doesn't initialize with a camera. See [this document](misc_frontend/robots.md) for more information.
- The Sticky Mitten Avatar responds to both physics and non-physics commands. The Magnebot responds only to certain physics commands.
- The Sticky Mitten Avatar moves around the scene by having forces continuously applied to it. The Magnebot has wheels (which in the API are just revolute joints without angle limits) that turn to move it forward.
- Magnebot has a somewhat difference shape and size than the Sticky Mitten Avatar.
- There are two variants of the Sticky Mitten Avatar: "A_StickyMitten_Adult" and "A_StickyMitten_Baby". There is only one Magnebot. However, the Magnebot can slide its torso up and down. You can constrain the height of the torso to be similar to either of the Sticky Mitten Avatars.
- The Sticky Mitten Avatar can pick up objects nearby a mitten (`pick_up_proximity`) or adjacent to a mitten (`pick_up`). The Magnebot only picks up objects adjacent to the magnet.
- When using a Sticky Mitten Avatar, the controller must continuously send `pick_up` or `pick_up_proximity` until the output data indicates that the object has been picked up. When using a Magnebot, the controller needs to send `set_magnet_targets`, after which the Magnebot will pick up any of those targets on the frame that the magnet collides with them.
- A Sticky Mitten Avatar picks up objects by attaching a breakable FixedJoint component. A Magnebot picks up objects by temporarily destroying the object's rigidbody and "fusing" it to the magnet. This means:
  - The link between a magnet and the object is unbreakable (and will never glitch) until the object is dropped.
  - Rigidbody commands such as `set_mass` can't be sent to objects held by a magnet.
  - `send_rigidbodies` will return default data for held objects.

### API Comparison

#### Creation and Destruction

| Sticky Mitten Avatar | Magnebot         |
| -------------------- | ---------------- |
| `create_avatar`      | `add_magnebot`   |
| `teleport_avatar_to` | `teleport_robot` |
| `destroy_avatar`     | `destroy_robot`  |

#### Movement

| Sticky Mitten Avatar               | Magnebot                                                     |
| ---------------------------------- | ------------------------------------------------------------ |
| `move_avatar_forward_by`           | `set_revolute_target`<br/><br/>Set target angles for the Magnebot's wheels. |
| `set_avatar_drag`                  | `set_immovable`                                              |
| `set_avatar_rigidbody_constraints` | `set_immovable`                                              |
| `turn_avatar_by`                   | `set_revolute_target`<br/><br/>Set target angles for the Magnebot's wheels. |

#### Arm Articulation

| Sticky Mitten Avatar | Magnebot                                                     |
| -------------------- | ------------------------------------------------------------ |
| `bend_arm_joint_by`  | `set_revolute_target`<br/>`set_spherical_target`<br/><br/>Add or subtract from the current angles. See: `Robot.get_joint_angles()`. |
| `bend_arm_joint_to`  | `set_revolute_target`<br/>`set_spherical_target`             |
| `pick_up`            | `set_magnet_targets`                                         |
| `put_down`           | `drop_from_magnet`                                           |
| `rotate_waist`       | `set_revolute_target`<br/><br/>Set a target angle for the Magnebot's column. Unlike the Sticky Mitten Avatar, this is a physics motion. |
| `stop_arm_joint`     | `set_revolute_target`<br/>`set_spherical_target`<br/><br/>Set the targets to the current angles. See: `Robot.get_joint_angles()`. |

#### Image capture

All commands normally used for a kinematic avatar are applicable to an avatar parented to a Magnebot via the command `parent_avatar_to_robot`.

#### Output Data

| Sticky Mitten Avatar              | Magnebot                           |
| --------------------------------- | ---------------------------------- |
| `send_avatars`                    | `send_robots`<br/>`send_magnebots` |
| `send_avatar_segmentation_colors` | `send_static_robots`               |

#### Joint Parameters

| Sticky Mitten Avatar                                         | Magnebot                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `adjust_joint_damper_by`<br>`adjust_joint_force_by`<br>`set_joint_damper`<br>`set_joint_force` | `set_robot_joint_drive`<br><br>Get the default joint drive parameters via `send_static_robots`. |

#### Unique to the Sticky Mitten Avatar

These commands don't have Magnebot versions because either they are for calibrating joint parameters (the Magnebot is better-calibrated than the Sticky Mitten Avatar), because of how the Magnebot is built, or because they involve irrelevant concepts (such as stickiness).

- `adjust_joint_angular_drag_by`
- `apply_force_to_avatar` 
- `enable_avatar_transparency`
- `rotate_head_by` 
- `set_avatar_collision_detection_mode` 
- `set_avatar_color`
- `set_avatar_mass`
- `set_avatar_physic_material`
- `set_joint_angular_drag`
- `set_stickiness`
- `set_sticky_mitten_profile`

#### Unique to the Magnebot

- `parent_avatar_to_robot`
- `set_prismatic_target`